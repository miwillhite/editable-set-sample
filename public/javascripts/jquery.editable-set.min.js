(function(a){a.fn.editableSet=function(c){var f=a.extend({},a.fn.editableSet.defaults,c);var e=function(g){g.editing=false;a.isFunction(f.onSave)&&f.onSave.call(g);var h=a("form",g);var i=h.attr("action");if(f.dataType==="json"){i=i+".json"}var j;if(f.globalSave){j=a("form",".editable").serialize()}else{j=h.serialize()}a.put(i,j,function(l,m){l=a.parseJSON(l)?a.parseJSON(l):l;if(f.globalSave){a.each(a(".editable"),function(n,o){a(o).html(a.fn.editableSet.globals.reversions[n]).removeClass("active");o.editing=false})}else{a(g).html(g.revert);a(g).removeClass("active")}var k;if(f.globalSave){a.each(a(".editable"),function(o,n){k=a("span[data-name]",n);a.isFunction(f.repopulate)&&f.repopulate.call(g,k,l,f)})}else{k=a("span[data-name]",g);a.isFunction(f.repopulate)&&f.repopulate.call(g,k,l,f)}a.isFunction(f.afterSave)&&f.afterSave.call(g,l,m)},f.dataType,function(m,k,l){g.editing=true;a(":input",g).attr("disabled",false);a.isFunction(f.onError)&&f.onError.call(g,m,k)})};var d=function(g){g.editing=false;a(g).html(g.revert).removeClass("active");a.isFunction(f.onCancel)&&f.onCancel.call(g)};return this.each(function(){var g=this;a(g).bind(f.event,function(j){j.preventDefault();j.stopPropagation();if(g.editing){return}g.editing=true;g.revert=a(g).html();if(a(this).attr("rel")){f.action=a(this).attr("rel")}if(f.globalSave){a.each(a(".editable"),function(k,l){a.fn.editableSet.globals.reversions.push(a(l).html())})}a.isFunction(f.beforeLoad)&&f.beforeLoad.call(g);a(g).wrapInner(a("<form />",{action:f.action,method:"POST"})).addClass("active");if(f.titleElement){a(f.titleElement,g).insertBefore(a("form",g))}var i;if(f.titleElement&&a(f.titleElement,g).length>0){i=a(f.titleElement,g)}else{i=a("form",g)}i.append(a("<input />",{type:"submit",value:"Save",click:function(){e(g);a(":input",g).attr("disabled",true);return false}}).addClass("form_submit"));i.append(a("<input />",{type:"button",value:"Cancel",click:function(){d(g);a(":input",g).attr("disabled",true);return false}}).addClass("form_cancel"));var h=a("span[data-name]",g);a.each(h,function(l,n){var k={};a.each(n.attributes,function(o){k[n.attributes[o].name]=n.attributes[o].value});k.value=a(n).html();k["data-type"]=k["data-type"]||"text";var m=k["data-type"];if(a.editableSet.types[m]){a.editableSet.types[m].element(n,k)}});a.isFunction(f.afterLoad)&&f.afterLoad.call(g)});a(window).unbind(".editableSet");a(window).bind("keydown.editableSet",function(h){if(h.keyCode==83&&(h.ctrlKey||h.metaKey)){h.preventDefault();e(g)}});a(window).bind("keydown.editableSet",function(h){if(h.keyCode==27){h.preventDefault();d(g)}})})};a.fn.editableSet.attributor=function(e,d){a.each(d,function(f,h){var g=/^data-/.test(f)?f.substr(5):f;e[0].setAttribute(g,h)});var c=d["data-prompt"];if(c){e.prepend(a("<option />",{value:"",text:c}))}return e};a.fn.editableSet.extractTextAndValue=function(d,e){var c={};if(d.constructor===Array){if(d[0].constructor===Array){c.value=d[e][1];c.text=d[e][0]}else{c.value=d[e];c.text=d[e]}}else{c.value=e;c.text=d[e]}return c};a.editableSet={types:{text:{element:function(d,c){var e=a.fn.editableSet.attributor(a("<input />"),c);a(d).replaceWith(e)}},email:{element:function(d,c){a.editableSet.types.text.element(d,c)}},url:{element:function(d,c){a.editableSet.types.text.element(d,c)}},number:{element:function(d,c){a.editableSet.types.text.element(d,c)}},range:{element:function(d,c){a.editableSet.types.text.element(d,c)}},hidden:{element:function(d,c){a.editableSet.types.text.element(d,c)}},textarea:{element:function(d,c){delete c["data-type"];var e=a.fn.editableSet.attributor(a("<textarea />"),c);e.text(c.value);a(d).replaceWith(e)}},checkbox:{element:function(d,c){c["data-checked_value"]=c["data-checked_value"]||"true";c["data-unchecked_value"]=c["data-unchecked_value"]||"false";if(c.value===c["data-checked_value"]){c["data-checked"]=true}c.value=c["data-checked_value"];var e=a.fn.editableSet.attributor(a("<input />"),c);a(d).replaceWith(e);a("<input />",{type:"hidden",value:c["data-unchecked_value"],name:c["data-name"]}).insertBefore(e)}},select:{element:function(e,d){var c=JSON.parse(d["data-options"]);var g=d.value;delete d["data-type"];delete d.value;delete d["data-options"];var f=a.fn.editableSet.attributor(a("<select />"),d);(function(){var i;for(i in c){var h=a.fn.editableSet.extractTextAndValue(c,i);a("<option />",{value:h.value,text:h.text}).appendTo(f)}})();a(e).replaceWith(f);a('option[text="'+g+'"]',f).attr("selected",true);a('option[value="'+g+'"]',f).attr("selected",true)}},radio:{element:function(g,f){var e=JSON.parse(f["data-options"]).reverse();delete f["data-options"];var d=f.value;var c=f["data-name"].replace(/\[|\]/g,"_");(function(){var i;for(i in e){var j=a.fn.editableSet.extractTextAndValue(e,i);f.value=j.value;f.id=c+j.value.split("").join("").replace(/\s/,"_").toLowerCase();var h=a.fn.editableSet.attributor(a("<input />"),f);if(h.val()===d||j.text===d){h.attr("checked",true)}a("<label />",{text:j.text}).append(h).insertAfter(a(g))}})();a(g).remove()}}},addInputType:function(d,c){a.editableSet.types[d]=c}};var b=function(c,e,d){a.each(c,function(k,n){var o=a(n).attr("data-name");var g={};if(o){var j=d.model||o.substr(0,o.indexOf("["));var h=o.replace(/\]\[|\[|\]/g,"_").replace(j,"").replace(/^_+|_+$/g,"");var p=h.split(/\d+_/).join("").split(/_attributes_/);if(p.length>1){var i;a.each(p,function(r,s){if(r<p.length-1){var q=new RegExp(s+"_attributes_(\\d+)");i=h.match(q);if(i){i=i[1]}g[s]=i||false}})}var f=p.pop();var l=e[j]||e,m;if(a.isEmptyObject(g)){m=l[f]}else{(function(){var q;for(q in g){l=l[q];if(g[q]){l=l[g[q]]}if(typeof l!=="undefined"&&typeof l[f]!=="undefined"){m=l[f]}}})()}if(typeof m!==undefined){a(n).text(m)}}})};a.fn.editableSet.defaults={event:"dblclick",action:"/",beforeLoad:a.noop,afterLoad:a.noop,onCancel:a.noop,onSave:a.noop,afterSave:a.noop,onError:a.noop,titleElement:false,globalSave:false,dataType:"script",repopulate:b};a.fn.editableSet.globals={reversions:[]}})(jQuery);function _ajax_request(b,d,f,c,e,a){if(jQuery.isFunction(d)){f=d;d={}}return jQuery.ajax({type:e,url:b,data:d,success:f,dataType:c,error:a})}jQuery.extend({put:function(b,d,e,c,a){return _ajax_request(b,d,e,c,"PUT",a)},delete_:function(b,d,e,c,a){return _ajax_request(b,d,e,c,"DELETE",a)}});
